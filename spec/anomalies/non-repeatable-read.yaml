name: "Non-Repeatable Read"
cases:
  - setup:
      - CREATE TABLE table_foo (id INT PRIMARY KEY)
      - INSERT INTO table_foo (id) VALUES (123)
    events:
      - timestamp: "timestamp-1"
        session: "session-1"
        statements:
          - sql: "BEGIN TRANSACTION"
          - sql: "SELECT COUNT(*) FROM table_foo WHERE id = 123"
            expected:
              - "1"
      - timestamp: "timestamp-2"
        session: "session-2"
        statements:
          - sql: "UPDATE table_foo SET id = 10000 WHERE id = 123"
      - timestamp: "timestamp-3"
        session: "session-1"
        statements:
          - sql: "SELECT COUNT(*) FROM table_foo WHERE id = 123"
            expected:
              - "0"
    teardown:
      - DROP TABLE IF EXISTS table_foo
